---
title: "Converting from Array to Data Frame and Viceversa"
author: "Mauro Lepore"
date: "2017-09-05"
output: 
  rmarkdown::html_vignette:
    toc: true
    toc_depth: 6
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, echo = FALSE, message=FALSE, warning=FALSE}
# hadley's settings
set.seed(1014)
options(digits = 3)

knitr::opts_chunk$set(
  echo = TRUE,  # {mine}
  comment = "#>",
  collapse = TRUE,
  # cache = TRUE,
  out.width = "70%",
  fig.align = "center",
  fig.width = 6,
  fig.asp = 0.618,  # 1 / phi
  fig.show = "hold"
)

options(dplyr.print_min = 6, dplyr.print_max = 6)
```

> We need two functions to translate from one format to the other to fully
explore the range of possibilities. (At least as tools to develop, not
necessarily for the package).

--\@gabrielato



```{r}
library(forestr)
library(plyr)
library(dplyr)

stem <- bci12s7mini
```



# From array to data frame

Example grouping by two variables.

```{r}
# USING `abundance_n()`

abundance_n <- function(x, group_by = c("quadrat", "sp"), only_alive = TRUE) {
    if (only_alive) {
      valid.status <- "A"
    } else {
      valid.status <- unique(x$status)
    }
    table(x[x$status %in% valid.status, group_by])
}

x1 <- abundance_n(stem, group_by = c("sp"), only_alive = FALSE)
length(dim(x1))

head(x1)
class(x1)

head(as.data.frame(x1))
# same
head(as.data.frame.array(x1))
# a little better
head(as.data.frame.table(x1))
```



# From data frame to array

__plyr__ can convert from class `data.frame` to class `array`.

```{r}
df <- abundance(stem, group_by = c("sp", "status"), only_alive = FALSE)
head(df)
a <- plyr::daply(df, .(sp, status), nrow)
head(a)
is.array(a)
```

With three grouping variables (using another dataset for simplicity)

```{r}
example_years <- c(1938, 1956, 1909, 1992)
example <- dplyr::filter(baseball, year %in% example_years)

# grouping by year, team and stint, to show array of 3 dimensions
groups <- c("year", "team", "stint")
(a <- plyr::daply(example, .variables = groups, .fun = nrow))
is.array(a)
```

Follow this discussion here: https://goo.gl/9pyXss.

