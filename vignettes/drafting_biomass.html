<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Gabriel Arellano, Sean McMahon &amp; Mauro Lepore" />

<meta name="date" content="2017-09-06" />

<title>Biomass</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Biomass</h1>
<h3 class="subtitle"><em>Drafting the biomass function.</em></h3>
<h4 class="author"><em>Gabriel Arellano, Sean McMahon &amp; Mauro Lepore</em></h4>
<h4 class="date"><em>2017-09-06</em></h4>


<div id="TOC">
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#goal">Goal</a></li>
<li><a href="#setup">Setup</a></li>
<li><a href="#last-thing-first-summarising-biomass-accross-individuals-by-groups">Last thing first: summarising biomass accross individuals by groups</a></li>
<li><a href="#calculate-individuals-biomass">Calculate individuals’ biomass</a><ul>
<li><a href="#flow">Flow</a></li>
</ul></li>
<li><a href="#appendix-a-side-note-on-function-names">Appendix: A side note on function names</a></li>
</ul>
</div>

<div id="overview" class="section level2">
<h2>Overview</h2>
<p>On Sept 6th, 2017, Gabriel, Sean and Mauro discussed what the biomass function of the <strong>forestr</strong> package should look like. This vignette targets developers and collaborators; Its goal is to record the main ideas we discussed so that we can build on them later.</p>
<p>The white-board notes from that meeting is <a href="https://drive.google.com/open?id=0B5fCyFlg2t4pR2RsbmpqaXRYa1pZNWM1cHhSZmlmRFdlbW04">here</a> (access private to Sean and Gabriel).</p>
</div>
<div id="goal" class="section level2">
<h2>Goal</h2>
<p>The biomass module has two jobs: to calculate individuals’ biomass and to summarize biomass within user-defined groups.</p>
<p>The second job we will address first. We choose this order because summarising biomass (or variable) is straight forward, but calculating each individual’s biomass isn’t. Biomass can be calculated in multiple ways, and users should be let to choose the way they think is best. So this vignette ends discussing the different ways to calculate biomass, which is the part for which discussion is more widely open.</p>
</div>
<div id="setup" class="section level2">
<h2>Setup</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="co">#&gt; Loading tidyverse: ggplot2</span>
<span class="co">#&gt; Loading tidyverse: tibble</span>
<span class="co">#&gt; Loading tidyverse: tidyr</span>
<span class="co">#&gt; Loading tidyverse: readr</span>
<span class="co">#&gt; Loading tidyverse: purrr</span>
<span class="co">#&gt; Loading tidyverse: dplyr</span>
<span class="co">#&gt; Conflicts with tidy packages ----------------------------------------------</span>
<span class="co">#&gt; filter(): dplyr, stats</span>
<span class="co">#&gt; lag():    dplyr, stats</span>
<span class="kw">library</span>(forestr)</code></pre></div>
<p>Loading some useful data of stems from 1000 trees, selected randomly from Barro Colorado Island (data made public in 2012, available at <a href="https://goo.gl/GmrwVq" class="uri">https://goo.gl/GmrwVq</a>; see also ?forestr::bci12s7mini).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># tibble has an informative print method</span>
stem0 &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(bci12s7mini)
stem0
<span class="co">#&gt; # A tibble: 2,165 x 20</span>
<span class="co">#&gt;   treeID stemID    tag StemTag     sp quadrat    gx    gy MeasureID</span>
<span class="co">#&gt;    &lt;int&gt;  &lt;int&gt;  &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;int&gt;</span>
<span class="co">#&gt; 1    858      1 000851         apeime    4402   899    42       766</span>
<span class="co">#&gt; 2   1083      1 001080    &lt;NA&gt; alchco    4314   873   284        NA</span>
<span class="co">#&gt; 3   1083      2 001080    &lt;NA&gt; alchco    4314   873   284        NA</span>
<span class="co">#&gt; 4   1083      3 001080    &lt;NA&gt; alchco    4314   873   284        NA</span>
<span class="co">#&gt; 5   1083      4 001080    &lt;NA&gt; alchco    4314   873   284        NA</span>
<span class="co">#&gt; 6   1083      5 001080    &lt;NA&gt; alchco    4314   873   284        NA</span>
<span class="co">#&gt; # ... with 2,159 more rows, and 11 more variables: CensusID &lt;int&gt;,</span>
<span class="co">#&gt; #   dbh &lt;dbl&gt;, pom &lt;chr&gt;, hom &lt;dbl&gt;, ExactDate &lt;chr&gt;, DFstatus &lt;chr&gt;,</span>
<span class="co">#&gt; #   codes &lt;chr&gt;, countPOM &lt;dbl&gt;, date &lt;dbl&gt;, status &lt;chr&gt;, agb &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="last-thing-first-summarising-biomass-accross-individuals-by-groups" class="section level2">
<h2>Last thing first: summarising biomass accross individuals by groups</h2>
<p>Here we focus on summarising biomass accross individuals by groups, not in the way to calculate the biomass of each individual. So we’ll just use the individuals’ biomass directly from the <code>agb</code> variable of a stem dataset from Barro Colorado Island. Apart from <code>agb</code> we’ll use a few more variables useful for calculating the by-groups summary.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># getting biomass as it comes out of the box from the analytical tables</span>
stem0$biomass &lt;-<span class="st"> </span>stem0$agb

<span class="co"># focusing only on a few variables we care about</span>
stem1 &lt;-<span class="st"> </span><span class="kw">select</span>(stem0, 
  treeID, stemID, quadrat, status, sp, biomass, 
)
stem1
<span class="co">#&gt; # A tibble: 2,165 x 6</span>
<span class="co">#&gt;   treeID stemID quadrat status     sp biomass</span>
<span class="co">#&gt;    &lt;int&gt;  &lt;int&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1    858      1    4402      A apeime    3.24</span>
<span class="co">#&gt; 2   1083      1    4314      G alchco      NA</span>
<span class="co">#&gt; 3   1083      2    4314      G alchco      NA</span>
<span class="co">#&gt; 4   1083      3    4314      G alchco      NA</span>
<span class="co">#&gt; 5   1083      4    4314      G alchco      NA</span>
<span class="co">#&gt; 6   1083      5    4314      G alchco      NA</span>
<span class="co">#&gt; # ... with 2,159 more rows</span></code></pre></div>
<p>Unfortunately, these data has no unique identifies. So let’s create one so we one so we can simplify the dataset without loosing information.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">add_id &lt;-<span class="st"> </span>function(x) {
  x$id &lt;-<span class="st"> </span><span class="kw">paste0</span>(x$treeID, <span class="st">&quot;_&quot;</span>, x$stemID)
  x
}
stem2 &lt;-<span class="st"> </span><span class="kw">add_id</span>(stem1)
stem2
<span class="co">#&gt; # A tibble: 2,165 x 7</span>
<span class="co">#&gt;   treeID stemID quadrat status     sp biomass     id</span>
<span class="co">#&gt;    &lt;int&gt;  &lt;int&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;  &lt;chr&gt;</span>
<span class="co">#&gt; 1    858      1    4402      A apeime    3.24  858_1</span>
<span class="co">#&gt; 2   1083      1    4314      G alchco      NA 1083_1</span>
<span class="co">#&gt; 3   1083      2    4314      G alchco      NA 1083_2</span>
<span class="co">#&gt; 4   1083      3    4314      G alchco      NA 1083_3</span>
<span class="co">#&gt; 5   1083      4    4314      G alchco      NA 1083_4</span>
<span class="co">#&gt; 6   1083      5    4314      G alchco      NA 1083_5</span>
<span class="co">#&gt; # ... with 2,159 more rows</span></code></pre></div>
<p><code>id</code> has the information from <code>treeID</code> and <code>stemID</code>; so we can safely remove <code>treeID</code> and <code>stemID</code>. We’ll take the change to re-organize the variables to improve clarity.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Removing redundant variables; also placing id first, and biomass last</span>
stem3 &lt;-<span class="st"> </span><span class="kw">select</span>(stem2, id, quadrat, status, sp, biomass)
stem3
<span class="co">#&gt; # A tibble: 2,165 x 5</span>
<span class="co">#&gt;       id quadrat status     sp biomass</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1  858_1    4402      A apeime    3.24</span>
<span class="co">#&gt; 2 1083_1    4314      G alchco      NA</span>
<span class="co">#&gt; 3 1083_2    4314      G alchco      NA</span>
<span class="co">#&gt; 4 1083_3    4314      G alchco      NA</span>
<span class="co">#&gt; 5 1083_4    4314      G alchco      NA</span>
<span class="co">#&gt; 6 1083_5    4314      G alchco      NA</span>
<span class="co">#&gt; # ... with 2,159 more rows</span></code></pre></div>
<p>A good way to summarize these data is to sum the biomass of all individuals in each species:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">by_sp &lt;-<span class="st"> </span><span class="kw">group_by</span>(stem3, sp)
by_sp &lt;-<span class="st"> </span>dplyr::<span class="kw">summarize</span>(by_sp, <span class="dt">biomass =</span> <span class="kw">sum</span>(biomass, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre></div>
<p>Or we may want to sumarize by summing the abundance of each species in each quadrat:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">by_sp_quad &lt;-<span class="st"> </span><span class="kw">group_by</span>(stem3, sp, quadrat)
by_sp_quad &lt;-<span class="st"> </span><span class="kw">summarize</span>(by_sp_quad, <span class="dt">biomass =</span> <span class="kw">sum</span>(biomass, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre></div>
<p>Here are the first few species and quadrats which biomas is greater than cero:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(by_sp_quad, biomass &gt;<span class="st"> </span><span class="dv">0</span>)
<span class="co">#&gt; # A tibble: 529 x 3</span>
<span class="co">#&gt; # Groups:   sp [105]</span>
<span class="co">#&gt;       sp quadrat  biomass</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 acaldi    1522 6.15e-04</span>
<span class="co">#&gt; 2 acaldi    3523 2.88e-04</span>
<span class="co">#&gt; 3 acaldi    3805 1.19e-04</span>
<span class="co">#&gt; 4 acaldi    4716 1.92e-04</span>
<span class="co">#&gt; 5 acaldi    4719 8.24e-05</span>
<span class="co">#&gt; 6 alibed    1315 6.41e-04</span>
<span class="co">#&gt; # ... with 523 more rows</span></code></pre></div>
<p>In conclusion, we can easily write a function that groups the data by any number of variables and summarizes it by summing the biomass of individuals within each group. Such a function can be written in a number of ways. We compared ways that used <strong>base</strong> exclusively with those that used <strong>dplyr</strong> and we found that the <strong>dplyr</strong> approach is orders of magnitude faster. So here what the <code>biomass()</code> function may look like:</p>
<pre><code>biomass &lt;- function(census, groups) {
  # Convert from character string to bare names (https://goo.gl/kPqMUk)
  parsed_groupes &lt;- lapply(groups, rlang::parse_quosure)
  
  # Group
  grouped &lt;- dplyr::group_by(x, rlang::UQS(parsed_groupes))
  
  # Summarize within groups
  count &lt;- dplyr::summarise(grouped, biomass = biomass_per_individual(.))
  
  # Make the output a common data structure
  as.data.frame(count)
}</code></pre>
<p>But how should we calculate the biomass of each individual?</p>
</div>
<div id="calculate-individuals-biomass" class="section level2">
<h2>Calculate individuals’ biomass</h2>
<p>We think that the way to calculate the biomass of each individual should depend on how well the user knows the allometry formulas of the species or site in the data.</p>
<p><code>biomass_per_individual()</code> would need two inputs:</p>
<ol style="list-style-type: lower-alpha">
<li>either census data and the name of the site, to calculate biomass with appropriate allometric formulas given by the <code>biomass_per_individual()</code> by default.</li>
<li>or census data and a custom allometry, to calculate biomass with allometric formulas given by the user.</li>
</ol>
<p>This is what the definition of `biomass_per_individual() may look like:</p>
<pre><code>biomass_per_individual &lt;- function (x, site, custom_allometry = NULL) {
  # some code
}</code></pre>
<div id="flow" class="section level3">
<h3>Flow</h3>
<p>This is a draft of the simplified flow.</p>
<pre><code>&lt; User provides data? &gt; 
|- NO: (Return Error 1)
YES: &lt; User provides site? &gt; 
     |- YES: (Use default Table A)
     NO: &lt; User provides custom allometry? &gt; 
         |- NO: (Return Error 2)
         YES: &lt; Is allometry a table? &gt;
              |- NO: &lt; Is allometry a formula? &gt; 
              |      |- NO: (Return Error 3)
              |      YES: (Make and use custom Table B)
              YES: &lt; Table has name &quot;species&quot; &gt;
                   |- YES: &lt; Use custom Table C? &gt;
                   NO: &lt; Table has name &quot;site&quot;? &gt;
                       |- NO: (Return Error 4)
                       YES: (Use custom Table D)



ERRORS

Error 1: Must provide data.
Error 2: Must provide either the site name or custom allometries.
Error 3: Custom allometry must be either a data frame or a formula.
Error 4: Custom table must contain names species or site.



TABLES

Table A (default): `site`, `formula`. I.e. formulas from Chave et al. 2014.
Table B (custom):  `site`, `formula`.
Table C (custom):  `species`, `formula`.
Table D (Custom):  `site`, `formula`.</code></pre>
<p>Whatever table <code>biomass()</code> uses, it should inform the user of what functions it is using. That communication may be via conditionals such as messages or warnings and maybe a log file. That information may be valuable for developers and users so they know that the function is doing what it should, and also useful to report methods in publications.</p>
</div>
</div>
<div id="appendix-a-side-note-on-function-names" class="section level2">
<h2>Appendix: A side note on function names</h2>
<blockquote>
<p>Generally, function names should be verbs, and arguments should be nouns. There are some exceptions: nouns are ok if the function computes a very well known noun (i.e. mean() is better than compute_mean()), or accessing some property of an object (i.e. coef() is better than get_coefficients()). A good sign that a noun might be a better choice is if you’re using a very broad verb like <strong>“get”</strong>, <strong>“compute”</strong>, <strong>“calculate”</strong>, or <strong>“determine”</strong>. Use your best judgement and don’t be afraid to rename a function if you figure out a better name later.</p>
</blockquote>
<p>–<a href="http://r4ds.had.co.nz/functions.html#functions" class="uri">http://r4ds.had.co.nz/functions.html#functions</a></p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
