<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Demography • forestr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">forestr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Functions Index</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/index.html">Tutorials</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Apps
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Nothing to show</li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://github.com/maurolepore">
    <span class="fa fa-gavel"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/forestgeo/forestr">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://forestgeo.github.io/fgeo/">fgeo</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Demography</h1>
                        <h4 class="author">Mauro Lepore</h4>
            
            <h4 class="date">2017-10-22</h4>
          </div>

    
    
<div class="contents">
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>This vignette shows you how to calculate demographic metrics with the functions <code><a href="../reference/recruitment.html">recruitment()</a></code>, <code><a href="../reference/recruitment.html">mortality()</a></code> and <code><a href="../reference/growth.html">growth()</a></code> from the <strong>forestr</strong> package – let’s load it now:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># To install from a private repo, generate a personal access token (PAT) in</span>
<span class="co"># https://github.com/settings/tokens and supply to this argument.</span>
 GITHUB_PAT &lt;-<span class="st"> "your token"</span>
<span class="co"># install_github("forestgeo/forestr@iss49_demography", auth_token = GITHUB_PAT)</span>
<span class="kw">library</span>(forestr)

<span class="co"># Also using the package tibble for nicer printing</span>
<span class="kw">library</span>(tibble)
<span class="co"># Print no more than 10 rows to save space and time</span>
<span class="kw">options</span>(<span class="dt">tibble.print_max =</span> <span class="dv">10</span>)</code></pre></div>
<p>You may be familiar with the functions <code><a href="../reference/abundance.html">abundance()</a></code>, <code><a href="../reference/basal_area.html">basal_area()</a></code> and <code>biomass()</code>, which input data from a single census and calculate a single metric per individual stem or group of stems. Unlike those functions, the ones you’ll see here operate quite differently: <code><a href="../reference/recruitment.html">recruitment()</a></code>, <code><a href="../reference/recruitment.html">mortality()</a></code> and <code><a href="../reference/growth.html">growth()</a></code> input data from two censuses and calculate multiple metrics across the entire data set, optionally spiting the data set by some variable. Because those two groups of functions work quite differently (the group of <code><a href="../reference/abundance.html">abundance()</a></code> versus that of <code><a href="../reference/recruitment.html">recruitment()</a></code>) making their interphases and output feel similar is not straight forward – so prepare for a little-different experience.</p>
</div>
<div id="recruitment-and-mortality" class="section level1">
<h1 class="hasAnchor">
<a href="#recruitment-and-mortality" class="anchor"></a>Recruitment and Mortality</h1>
<p>Currently <code><a href="../reference/recruitment.html">recruitment()</a></code> and <code><a href="../reference/recruitment.html">mortality()</a></code> are more similar to each other than they are to <code><a href="../reference/growth.html">growth()</a></code>. (From a technical point of view the most important difference is that <code><a href="../reference/growth.html">growth()</a></code> has currently many more arguments than the other two functions). To reflect that relationship <code><a href="../reference/recruitment.html">recruitment()</a></code> and <code><a href="../reference/recruitment.html">mortality()</a></code> are documented together. The next two commands present you with the same help file.</p>
<pre><code>?recruitment
# same
?mortality</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Some data to play with</span>
census1 &lt;-<span class="st"> </span>forestr<span class="op">::</span>bci12t6mini
census2 &lt;-<span class="st"> </span>forestr<span class="op">::</span>bci12t7mini



<span class="co"># Using the new wrapper `&lt;FUNCTION&gt;_df()` ---------------------------------</span>

<span class="co"># A REALISTIC CASE</span>

<span class="co"># Note `recruitment_df()` warns if some groups have dbh values full of NA</span>
split_by_sp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/recruitment.html">recruitment_df</a></span>(census1, census2, <span class="dt">split1 =</span> census1<span class="op">$</span>sp)
<span class="co">#&gt; Warning in check_if_all_dbh_is_na(census1, census2, split = split1): At least one split-group contains all `dbh` values equal to NA.</span>
<span class="co">#&gt;   * Consider removing those groups before running this function.</span>
split_by_sp
<span class="co">#&gt; # A tibble: 1,152 x 3</span>
<span class="co">#&gt;    split metric  value</span>
<span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 acaldi     N2 5.0000</span>
<span class="co">#&gt; 2 acaldi      R 2.0000</span>
<span class="co">#&gt; 3 acaldi   rate 0.1032</span>
<span class="co">#&gt; 4 acaldi  lower 0.0254</span>
<span class="co">#&gt; 5 acaldi  upper 0.3035</span>
<span class="co">#&gt; 6 acaldi   time 4.9483</span>
<span class="co">#&gt; # ... with 1,146 more rows</span>

<span class="co"># Same for `mortality_df()`; let's explore a few species</span>
<span class="co"># We don't need to be warned again (suppressing warnings)</span>
all_species &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(
  <span class="kw"><a href="../reference/recruitment.html">mortality_df</a></span>(census1, census2, <span class="dt">split1 =</span> census1<span class="op">$</span>sp)
)
few_species &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">unique</span>(all_species<span class="op">$</span>split), <span class="dv">5</span>)
long_format &lt;-<span class="st"> </span><span class="kw">subset</span>(all_species, split <span class="op">%in%</span><span class="st"> </span>few_species)
long_format
<span class="co">#&gt; # A tibble: 45 x 3</span>
<span class="co">#&gt;    split metric value</span>
<span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 aegipa      N     0</span>
<span class="co">#&gt; 2 aegipa      D     0</span>
<span class="co">#&gt; 3 aegipa   rate    NA</span>
<span class="co">#&gt; 4 aegipa  lower    NA</span>
<span class="co">#&gt; 5 aegipa  upper    NA</span>
<span class="co">#&gt; 6 aegipa   time    NA</span>
<span class="co">#&gt; # ... with 39 more rows</span>

<span class="co"># From long to wide format</span>
<span class="kw">library</span>(tidyr)

wide_format &lt;-<span class="st"> </span>tidyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/spread">spread</a></span>(long_format, <span class="dt">key =</span> split, <span class="dt">value =</span> value)
wide_format
<span class="co">#&gt; # A tibble: 9 x 6</span>
<span class="co">#&gt;    metric aegipa   aspicr   cecrin ocotce   sipagu</span>
<span class="co">#&gt; *   &lt;chr&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1       D      0 0.00e+00 2.00e+00      0 0.00e+00</span>
<span class="co">#&gt; 2   date1     NA 1.66e+04 1.65e+04     NA 1.65e+04</span>
<span class="co">#&gt; 3   date2     NA 1.84e+04 1.84e+04     NA 1.83e+04</span>
<span class="co">#&gt; 4 dbhmean     NA 3.40e+01 1.08e+02     NA 2.20e+01</span>
<span class="co">#&gt; 5   lower     NA 0.00e+00 3.11e-02     NA 0.00e+00</span>
<span class="co">#&gt; 6       N      0 1.00e+00 4.00e+00      0 1.00e+00</span>
<span class="co">#&gt; 7    rate     NA 0.00e+00 1.36e-01     NA 0.00e+00</span>
<span class="co">#&gt; 8    time     NA 4.95e+00 5.10e+00     NA 4.96e+00</span>
<span class="co">#&gt; 9   upper     NA 3.73e-01 3.76e-01     NA 3.72e-01</span>

<span class="co"># THE SIMPLEST CASE</span>

<span class="co"># split1 defaults to `NULL`; output keeps the variable `split` for consistency</span>
split_null &lt;-<span class="st"> </span><span class="kw"><a href="../reference/recruitment.html">recruitment_df</a></span>(census1, census2)
split_null
<span class="co">#&gt; # A tibble: 8 x 3</span>
<span class="co">#&gt;   split metric    value</span>
<span class="co">#&gt;   &lt;int&gt;  &lt;chr&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1     N2 5.54e+02</span>
<span class="co">#&gt; 2     1      R 7.10e+01</span>
<span class="co">#&gt; 3     1   rate 2.76e-02</span>
<span class="co">#&gt; 4     1  lower 2.19e-02</span>
<span class="co">#&gt; 5     1  upper 3.48e-02</span>
<span class="co">#&gt; 6     1   time 4.97e+00</span>
<span class="co">#&gt; 7     1  date1 1.66e+04</span>
<span class="co">#&gt; 8     1  date2 1.84e+04</span>

<span class="co"># For this simple case, you may want to use this alternative approach</span>
result &lt;-<span class="st"> </span><span class="kw"><a href="../reference/recruitment.html">recruitment</a></span>(census1, census2)
result_df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">unlist</span>(result))
<span class="kw">head</span>(result_df, <span class="dv">10</span>)
<span class="co">#&gt;       unlist(result)</span>
<span class="co">#&gt; N2          5.54e+02</span>
<span class="co">#&gt; R           7.10e+01</span>
<span class="co">#&gt; rate        2.76e-02</span>
<span class="co">#&gt; lower       2.19e-02</span>
<span class="co">#&gt; upper       3.48e-02</span>
<span class="co">#&gt; time        4.97e+00</span>
<span class="co">#&gt; date1       1.66e+04</span>
<span class="co">#&gt; date2       1.84e+04</span>

<span class="co"># But that approach doesn't help with splitting variables because we loose </span>
<span class="co"># information about what matric each value belongs to</span>
result &lt;-<span class="st"> </span><span class="kw"><a href="../reference/recruitment.html">recruitment</a></span>(census1, census2, <span class="dt">split1 =</span> census1<span class="op">$</span>sp)
<span class="co">#&gt; Warning in check_if_all_dbh_is_na(census1, census2, split = split1): At least one split-group contains all `dbh` values equal to NA.</span>
<span class="co">#&gt;   * Consider removing those groups before running this function.</span>
result_df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">unlist</span>(result))
<span class="kw">head</span>(result_df, <span class="dv">10</span>)
<span class="co">#&gt;           unlist(result)</span>
<span class="co">#&gt; N2.acaldi              5</span>
<span class="co">#&gt; N2.aegipa              0</span>
<span class="co">#&gt; N2.alchco              0</span>
<span class="co">#&gt; N2.alibed              2</span>
<span class="co">#&gt; N2.allops              0</span>
<span class="co">#&gt; N2.alsebl             20</span>
<span class="co">#&gt; N2.anaxpa              1</span>
<span class="co">#&gt; N2.andiin              0</span>
<span class="co">#&gt; N2.annoac              3</span>
<span class="co">#&gt; N2.annosp              0</span>

<span class="co"># Using the traditional functions -----------------------------------------</span>

<span class="co"># The output is more ackward to explore</span>
traditional_by_sp &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(
  <span class="kw"><a href="../reference/recruitment.html">recruitment</a></span>(census1, census2, <span class="dt">split1 =</span> census1<span class="op">$</span>sp)
)
<span class="kw">str</span>(traditional_by_sp)
<span class="co">#&gt; List of 8</span>
<span class="co">#&gt;  $ N2   : Named num [1:144] 5 0 0 2 0 20 1 0 3 0 ...</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;  $ R    : Named num [1:144] 2 0 0 1 0 6 0 0 1 0 ...</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;  $ rate : Named num [1:144] 0.103 NA NA 0.141 NA ...</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;  $ lower: Named num [1:144] 0.0254 NA NA 0.0201 NA ...</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;  $ upper: Named num [1:144] 0.303 NA NA 0.48 NA ...</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;  $ time : Named num [1:144] 4.95 NA NA 4.92 NA ...</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;  $ date1: Named num [1:144] 16639 NA 16720 16533 NA ...</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;  $ date2: Named num [1:144] 18464 NA NA 18387 NA ...</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>

<span class="co"># In RStudio 1.1 the function `View()` will help you see ackward lists.</span>
<span class="co"># Here showing a simple trick</span>
<span class="kw">lapply</span>(traditional_by_sp, head)
<span class="co">#&gt; $N2</span>
<span class="co">#&gt; acaldi aegipa alchco alibed allops alsebl </span>
<span class="co">#&gt;      5      0      0      2      0     20 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $R</span>
<span class="co">#&gt; acaldi aegipa alchco alibed allops alsebl </span>
<span class="co">#&gt;      2      0      0      1      0      6 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $rate</span>
<span class="co">#&gt; acaldi aegipa alchco alibed allops alsebl </span>
<span class="co">#&gt; 0.1032     NA     NA 0.1408     NA 0.0713 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $lower</span>
<span class="co">#&gt; acaldi aegipa alchco alibed allops alsebl </span>
<span class="co">#&gt; 0.0254     NA     NA 0.0201     NA 0.0315 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $upper</span>
<span class="co">#&gt; acaldi aegipa alchco alibed allops alsebl </span>
<span class="co">#&gt;  0.303     NA     NA  0.480     NA  0.147 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $time</span>
<span class="co">#&gt; acaldi aegipa alchco alibed allops alsebl </span>
<span class="co">#&gt;   4.95     NA     NA   4.92     NA   5.00 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $date1</span>
<span class="co">#&gt; acaldi aegipa alchco alibed allops alsebl </span>
<span class="co">#&gt;  16639     NA  16720  16533     NA  16551 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $date2</span>
<span class="co">#&gt; acaldi aegipa alchco alibed allops alsebl </span>
<span class="co">#&gt;  18464     NA     NA  18387     NA  18385</span>

<span class="co"># `recruitment()` can take up to two splitting variables; not `recruitment_df()`</span>
traditional_by_sp_and_quadrat &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(
  <span class="kw"><a href="../reference/recruitment.html">recruitment</a></span>(census1, census2, <span class="dt">split1 =</span> census1<span class="op">$</span>sp, <span class="dt">split2 =</span> census1<span class="op">$</span>quadrat)
)
<span class="kw">str</span>(traditional_by_sp_and_quadrat)
<span class="co">#&gt; List of 8</span>
<span class="co">#&gt;  $ N2   : num [1:144, 1:664] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:664] "0000" "0001" "0002" "0006" ...</span>
<span class="co">#&gt;  $ R    : num [1:144, 1:664] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:664] "0000" "0001" "0002" "0006" ...</span>
<span class="co">#&gt;  $ rate : num [1:144, 1:664] NA NA NA NA NA NA NA NA NA NA ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:664] "0000" "0001" "0002" "0006" ...</span>
<span class="co">#&gt;  $ lower: num [1:144, 1:664] NA NA NA NA NA NA NA NA NA NA ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:664] "0000" "0001" "0002" "0006" ...</span>
<span class="co">#&gt;  $ upper: num [1:144, 1:664] NA NA NA NA NA NA NA NA NA NA ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:664] "0000" "0001" "0002" "0006" ...</span>
<span class="co">#&gt;  $ time : num [1:144, 1:664] NA NA NA NA NA NA NA NA NA NA ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:664] "0000" "0001" "0002" "0006" ...</span>
<span class="co">#&gt;  $ date1: num [1:144, 1:664] NA NA NA NA NA NA NA NA NA NA ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:664] "0000" "0001" "0002" "0006" ...</span>
<span class="co">#&gt;  $ date2: num [1:144, 1:664] NA NA NA NA NA NA NA NA NA NA ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:664] "0000" "0001" "0002" "0006" ...</span>

<span class="co"># This intentionally fails -- to keep the output easy to view and manipulate</span>
<span class="kw"><a href="../reference/recruitment.html">recruitment_df</a></span>(census1, census2, <span class="dt">split1 =</span> census1<span class="op">$</span>sp, <span class="dt">split2 =</span> census1<span class="op">$</span>quadrat)
<span class="co">#&gt; Error in recruitment_df(census1, census2, split1 = census1$sp, split2 = census1$quadrat): unused argument (split2 = census1$quadrat)</span>

<span class="co"># Warnings and errors -----------------------------------------------------</span>

<span class="co"># This section will run only if the package ctfs is installed. </span>
ctfs_is_available &lt;-<span class="st"> </span><span class="kw">requireNamespace</span>(<span class="st">"ctfs"</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)
<span class="cf">if</span> (ctfs_is_available) {
  
<span class="co"># Notice that the original `recruitment()` from ctfs gives no warnings</span>
<span class="co"># No warning</span>
with_ctfs &lt;-<span class="st"> </span>ctfs<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ctfs/topics/recruitment">recruitment</a></span>(census1, census2, <span class="dt">split1 =</span> census1<span class="op">$</span>sp)
<span class="co"># Warning</span>
with_forestr &lt;-<span class="st"> </span>forestr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/forestr/topics/recruitment">recruitment</a></span>(census1, census2, <span class="dt">split1 =</span> census1<span class="op">$</span>sp)

<span class="co"># What happens if input is wrong?</span>

<span class="co"># Introducing a wrong name for an important variable</span>
wrong_nm1 &lt;-<span class="st"> </span>census1
wrong_nm2 &lt;-<span class="st"> </span>census2
wrong_nm1<span class="op">$</span>DBH &lt;-<span class="st"> </span>wrong_nm1<span class="op">$</span>dbh
wrong_nm1<span class="op">$</span>dbh &lt;-<span class="st"> </span><span class="ot">NULL</span>
wrong_nm2<span class="op">$</span>DBH &lt;-<span class="st"> </span>wrong_nm2<span class="op">$</span>dbh
wrong_nm2<span class="op">$</span>dbh &lt;-<span class="st"> </span><span class="ot">NULL</span>

<span class="co"># Uninformative error (gets picked up too far into the function)</span>
with_ctfs &lt;-<span class="st"> </span>ctfs<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ctfs/topics/recruitment">recruitment</a></span>(wrong_nm1, wrong_nm2, <span class="dt">split1 =</span> wrong_nm1<span class="op">$</span>sp)

<span class="co"># More informative error (gets picket up at the top of the function)</span>
with_forestr &lt;-<span class="st"> </span>forestr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/forestr/topics/recruitment">recruitment</a></span>(wrong_nm1, wrong_nm2, <span class="dt">split1 =</span> wrong_nm1<span class="op">$</span>sp)

}
<span class="co">#&gt; Warning in check_if_all_dbh_is_na(census1, census2, split = split1): At least one split-group contains all `dbh` values equal to NA.</span>
<span class="co">#&gt;   * Consider removing those groups before running this function.</span>
<span class="co">#&gt; Error in split.default(X, group): first argument must be a vector</span></code></pre></div>
</div>
<div id="growth" class="section level1">
<h1 class="hasAnchor">
<a href="#growth" class="anchor"></a>Growth</h1>
<p>Compared to <code><a href="../reference/recruitment.html">recruitment()</a></code> and <code><a href="../reference/recruitment.html">mortality()</a></code>, <code><a href="../reference/growth.html">growth()</a></code> has currently many more arguments, so it’s documented separately. Yet much of the documentation is the same – <code><a href="../reference/growth.html">growth()</a></code> inherits arguments and description from <code><a href="../reference/recruitment.html">recruitment()</a></code> and <code><a href="../reference/recruitment.html">mortality()</a></code> (see <code>?growth()</code>). This section starts with what <code><a href="../reference/growth.html">growth()</a></code> shares with <code><a href="../reference/recruitment.html">recruitment()</a></code> and <code><a href="../reference/recruitment.html">mortality()</a></code> and then shows some arguments exclusive of <code><a href="../reference/growth.html">growth()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Using the same data as above.</span>
<span class="co"># You can expect the same warnings about `dbh` eualt to NA within some groups</span>
<span class="co"># defined by `split1 = census1$sp` and `split2 = census1$quadrat`</span>
census1 &lt;-<span class="st"> </span>forestr<span class="op">::</span>bci12t6mini
census2 &lt;-<span class="st"> </span>forestr<span class="op">::</span>bci12t7mini

<span class="co"># Using the new wrapper `&lt;FUNCTION&gt;_df()` ---------------------------------</span>

<span class="co"># A REALISTIC CASE</span>

<span class="co"># Note `growth_df()` warns if some groups have dbh values full of NA</span>
split_by_sp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/growth.html">growth_df</a></span>(census1, census2, <span class="dt">split1 =</span> census1<span class="op">$</span>sp)
<span class="co">#&gt; Warning in check_if_all_dbh_is_na(census1, census2, split = split1): At least one split-group contains all `dbh` values equal to NA.</span>
<span class="co">#&gt;   * Consider removing those groups before running this function.</span>
split_by_sp
<span class="co">#&gt; # A tibble: 1,008 x 3</span>
<span class="co">#&gt;    split  metric    value</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 acaldi    rate 7.09e-01</span>
<span class="co">#&gt; 2 acaldi       N 2.00e+00</span>
<span class="co">#&gt; 3 acaldi    clim 1.32e+00</span>
<span class="co">#&gt; 4 acaldi dbhmean 1.10e+01</span>
<span class="co">#&gt; 5 acaldi    time 4.95e+00</span>
<span class="co">#&gt; 6 acaldi   date1 1.67e+04</span>
<span class="co">#&gt; # ... with 1,002 more rows</span>

<span class="co"># Same for `growth_df()`; let's explore a few species</span>
<span class="co"># We don't need to be warned again (suppressing warnings)</span>
all_species &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(
  <span class="kw"><a href="../reference/growth.html">growth_df</a></span>(census1, census2, <span class="dt">split1 =</span> census1<span class="op">$</span>sp)
)
few_species &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">unique</span>(all_species<span class="op">$</span>split), <span class="dv">5</span>)
long_format &lt;-<span class="st"> </span><span class="kw">subset</span>(all_species, split <span class="op">%in%</span><span class="st"> </span>few_species)
long_format
<span class="co">#&gt; # A tibble: 35 x 3</span>
<span class="co">#&gt;    split  metric    value</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 ery2ma    rate 2.05e-01</span>
<span class="co">#&gt; 2 ery2ma       N 1.00e+00</span>
<span class="co">#&gt; 3 ery2ma    clim       NA</span>
<span class="co">#&gt; 4 ery2ma dbhmean 1.40e+01</span>
<span class="co">#&gt; 5 ery2ma    time 4.89e+00</span>
<span class="co">#&gt; 6 ery2ma   date1 1.66e+04</span>
<span class="co">#&gt; # ... with 29 more rows</span>

<span class="co"># From long to wide format</span>
<span class="kw">library</span>(tidyr)
wide_format &lt;-<span class="st"> </span>tidyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/spread">spread</a></span>(long_format, <span class="dt">key =</span> split, <span class="dt">value =</span> value)
wide_format
<span class="co">#&gt; # A tibble: 7 x 6</span>
<span class="co">#&gt;    metric   ery2ma ingaqu   ingaum   protpa psycg3</span>
<span class="co">#&gt; *   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1    clim       NA     NA 4.28e-01 3.10e-01     NA</span>
<span class="co">#&gt; 2   date1 1.66e+04     NA 1.65e+04 1.66e+04     NA</span>
<span class="co">#&gt; 3   date2 1.84e+04     NA 1.83e+04 1.84e+04     NA</span>
<span class="co">#&gt; 4 dbhmean 1.40e+01     NA 4.45e+01 2.88e+01     NA</span>
<span class="co">#&gt; 5       N 1.00e+00      0 2.00e+00 5.00e+00      0</span>
<span class="co">#&gt; 6    rate 2.05e-01     NA 6.97e-01 2.82e-01     NA</span>
<span class="co">#&gt; 7    time 4.89e+00     NA 5.02e+00 4.95e+00     NA</span>

<span class="co"># THE SIMPLEST CASE</span>

<span class="co"># split1 defaults to `NULL`; output keeps the variable `split` for consistency</span>
split_null &lt;-<span class="st"> </span><span class="kw"><a href="../reference/growth.html">growth_df</a></span>(census1, census2)
split_null
<span class="co">#&gt; # A tibble: 7 x 3</span>
<span class="co">#&gt;   split  metric    value</span>
<span class="co">#&gt;   &lt;int&gt;   &lt;chr&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1    rate 1.13e+00</span>
<span class="co">#&gt; 2     1       N 3.83e+02</span>
<span class="co">#&gt; 3     1    clim 2.17e-01</span>
<span class="co">#&gt; 4     1 dbhmean 4.96e+01</span>
<span class="co">#&gt; 5     1    time 4.97e+00</span>
<span class="co">#&gt; 6     1   date1 1.66e+04</span>
<span class="co">#&gt; 7     1   date2 1.84e+04</span>

<span class="co"># Using the traditional functions -----------------------------------------</span>

<span class="co"># The output is more ackward to explore</span>
traditional_by_sp &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(
  <span class="kw"><a href="../reference/growth.html">growth</a></span>(census1, census2, <span class="dt">split1 =</span> census1<span class="op">$</span>sp)
)
<span class="kw">str</span>(traditional_by_sp)
<span class="co">#&gt; List of 7</span>
<span class="co">#&gt;  $ rate   : Named num [1:144] 0.709 NA NA 1.209 NA ...</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;  $ N      : Named num [1:144] 2 0 0 1 0 13 0 0 0 0 ...</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;  $ clim   : Named num [1:144] 1.32 NA NA NA NA ...</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;  $ dbhmean: Named num [1:144] 11 NA NA 12 NA ...</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;  $ time   : Named num [1:144] 4.95 NA NA 4.96 NA ...</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;  $ date1  : Named num [1:144] 16671 NA NA 16533 NA ...</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;  $ date2  : Named num [1:144] 18477 NA NA 18345 NA ...</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>

<span class="co"># In RStudio 1.1 the function `View()` will help you see ackward lists.</span>
<span class="co"># Here showing a simple trick</span>
<span class="kw">lapply</span>(traditional_by_sp, head)
<span class="co">#&gt; $rate</span>
<span class="co">#&gt; acaldi aegipa alchco alibed allops alsebl </span>
<span class="co">#&gt;  0.709     NA     NA  1.209     NA  0.755 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $N</span>
<span class="co">#&gt; acaldi aegipa alchco alibed allops alsebl </span>
<span class="co">#&gt;      2      0      0      1      0     13 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $clim</span>
<span class="co">#&gt; acaldi aegipa alchco alibed allops alsebl </span>
<span class="co">#&gt;   1.32     NA     NA     NA     NA   0.61 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dbhmean</span>
<span class="co">#&gt; acaldi aegipa alchco alibed allops alsebl </span>
<span class="co">#&gt;   11.0     NA     NA   12.0     NA   43.8 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $time</span>
<span class="co">#&gt; acaldi aegipa alchco alibed allops alsebl </span>
<span class="co">#&gt;   4.95     NA     NA   4.96     NA   4.97 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $date1</span>
<span class="co">#&gt; acaldi aegipa alchco alibed allops alsebl </span>
<span class="co">#&gt;  16671     NA     NA  16533     NA  16573 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $date2</span>
<span class="co">#&gt; acaldi aegipa alchco alibed allops alsebl </span>
<span class="co">#&gt;  18477     NA     NA  18345     NA  18389</span>

<span class="co"># `growth()` can take up to two splitting variables; not `growth_df()`</span>
traditional_by_sp_and_quadrat &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(
  <span class="kw"><a href="../reference/growth.html">growth</a></span>(census1, census2, <span class="dt">split1 =</span> census1<span class="op">$</span>sp, <span class="dt">split2 =</span> census1<span class="op">$</span>quadrat)
)
<span class="kw">str</span>(traditional_by_sp_and_quadrat)
<span class="co">#&gt; List of 7</span>
<span class="co">#&gt;  $ rate   : num [1:144, 1:664] NA NA NA NA NA NA NA NA NA NA ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:664] "0000" "0001" "0002" "0006" ...</span>
<span class="co">#&gt;  $ N      : num [1:144, 1:664] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:664] "0000" "0001" "0002" "0006" ...</span>
<span class="co">#&gt;  $ clim   : num [1:144, 1:664] NA NA NA NA NA NA NA NA NA NA ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:664] "0000" "0001" "0002" "0006" ...</span>
<span class="co">#&gt;  $ dbhmean: num [1:144, 1:664] NA NA NA NA NA NA NA NA NA NA ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:664] "0000" "0001" "0002" "0006" ...</span>
<span class="co">#&gt;  $ time   : num [1:144, 1:664] NA NA NA NA NA NA NA NA NA NA ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:664] "0000" "0001" "0002" "0006" ...</span>
<span class="co">#&gt;  $ date1  : num [1:144, 1:664] NA NA NA NA NA NA NA NA NA NA ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:664] "0000" "0001" "0002" "0006" ...</span>
<span class="co">#&gt;  $ date2  : num [1:144, 1:664] NA NA NA NA NA NA NA NA NA NA ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:144] "acaldi" "aegipa" "alchco" "alibed" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:664] "0000" "0001" "0002" "0006" ...</span>

<span class="co"># This intentionally fails -- to keep the output easy to view and manipulate</span>
<span class="kw"><a href="../reference/growth.html">growth_df</a></span>(census1, census2, <span class="dt">split1 =</span> census1<span class="op">$</span>sp, <span class="dt">split2 =</span> census1<span class="op">$</span>quadrat)
<span class="co">#&gt; Error in growth_df(census1, census2, split1 = census1$sp, split2 = census1$quadrat): unused argument (split2 = census1$quadrat)</span>

<span class="co"># Warnings and errors -----------------------------------------------------</span>

<span class="co"># Notice that the original `growth()` from ctfs gives no warnings</span>
<span class="co"># No warning</span>
with_ctfs &lt;-<span class="st"> </span>ctfs<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ctfs/topics/growth">growth</a></span>(census1, census2, <span class="dt">split1 =</span> census1<span class="op">$</span>sp)
<span class="co"># Warning</span>
with_forestr &lt;-<span class="st"> </span>forestr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/forestr/topics/growth">growth</a></span>(census1, census2, <span class="dt">split1 =</span> census1<span class="op">$</span>sp)
<span class="co">#&gt; Warning in check_if_all_dbh_is_na(census1, census2, split = split1): At least one split-group contains all `dbh` values equal to NA.</span>
<span class="co">#&gt;   * Consider removing those groups before running this function.</span>

<span class="co"># What happens if input is wrong?</span>

<span class="co"># Introducing a wrong name for an important variable</span>
wrong_nm1 &lt;-<span class="st"> </span>census1
wrong_nm2 &lt;-<span class="st"> </span>census2
wrong_nm1<span class="op">$</span>DBH &lt;-<span class="st"> </span>wrong_nm1<span class="op">$</span>dbh
wrong_nm1<span class="op">$</span>dbh &lt;-<span class="st"> </span><span class="ot">NULL</span>
wrong_nm2<span class="op">$</span>DBH &lt;-<span class="st"> </span>wrong_nm2<span class="op">$</span>dbh
wrong_nm2<span class="op">$</span>dbh &lt;-<span class="st"> </span><span class="ot">NULL</span>

<span class="co"># Uninformative error (gets picked up too far into the function)</span>
with_ctfs &lt;-<span class="st"> </span>ctfs<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ctfs/topics/growth">growth</a></span>(wrong_nm1, wrong_nm2, <span class="dt">split1 =</span> wrong_nm1<span class="op">$</span>sp)
<span class="co">#&gt; Error in `[.data.frame`(census1, , growthcol): undefined columns selected</span>

<span class="co"># More informative error (gets picket up at the top of the function)</span>
with_forestr &lt;-<span class="st"> </span>forestr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/forestr/topics/growth">growth</a></span>(wrong_nm1, wrong_nm2, <span class="dt">split1 =</span> wrong_nm1<span class="op">$</span>sp)
<span class="co">#&gt; Error: Check that your data contains these names: dbh, pom, status, date, stemID</span>

<span class="co"># Some arguments exclusive of `growth()` ----------------------------------</span>

<span class="co"># Here are exclusive arguments of growth; read about the others at `?growth()`</span>

<span class="co"># Calculate not annual growth rate but relative growth rate</span>
<span class="co"># Unlisting to fit all metrics in one line and save space</span>
<span class="kw">unlist</span>(<span class="kw"><a href="../reference/growth.html">growth</a></span>(census1, census2, <span class="dt">method =</span> <span class="st">"E"</span>))
<span class="co">#&gt;     rate        N     clim  dbhmean     time    date1    date2 </span>
<span class="co">#&gt; 2.60e-02 3.83e+02 3.45e-03 4.96e+01 4.97e+00 1.66e+04 1.84e+04</span>

<span class="co"># Return `sd` instead of `clim`</span>
<span class="kw">unlist</span>(<span class="kw"><a href="../reference/growth.html">growth</a></span>(census1, census2, <span class="dt">stdev =</span> <span class="ot">TRUE</span>))
<span class="co">#&gt;     rate        N       sd  dbhmean     time    date1    date2 </span>
<span class="co">#&gt;     1.13   383.00     2.16    49.56     4.97 16578.33 18393.57</span>

<span class="co"># Include all living trees</span>
<span class="kw">unlist</span>(<span class="kw"><a href="../reference/growth.html">growth</a></span>(census1, census2, <span class="dt">mindbh =</span> <span class="ot">NULL</span>))
<span class="co">#&gt;     rate        N     clim  dbhmean     time    date1    date2 </span>
<span class="co">#&gt; 1.13e+00 3.83e+02 2.17e-01 4.96e+01 4.97e+00 1.66e+04 1.84e+04</span>

<span class="co"># Measure growth not based on `dbh` but on `agb`</span>
<span class="kw">unlist</span>(<span class="kw"><a href="../reference/growth.html">growth</a></span>(census1, census2, <span class="dt">growthcol =</span> <span class="st">"agb"</span>))
<span class="co">#&gt;     rate        N     clim  dbhmean     time    date1    date2 </span>
<span class="co">#&gt; 1.74e-03 3.83e+02 9.43e-04 4.96e+01 4.97e+00 1.66e+04 1.84e+04</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#recruitment-and-mortality">Recruitment and Mortality</a></li>
      <li><a href="#growth">Growth</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/maurolepore">Mauro Lepore</a>, <a href="http://www.forestgeo.si.edu/">CTFS-ForestGEO</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
